# BlogVulnerabilityResolve
硕士Software Project Management and Secure Development课程设计，寻找基于PHP框架fat-free开发的博客网站的漏洞并修补。

### SQL Injection Vulnerability

***

##### 漏洞复现、影响、所在URL：

1.	The user could input some special characters to the interface of the website which needs to access the database. So the user could execute the sql code in the system.
2.	http://localhost/blog/search/    http://localhost/user/login/
3.	The search() method in the blog.php file; the login() method in the user.php file, and the login method in the authhelper.php file.
4.	The information of database will leakage, and the database could be maliciously operated: the database server is attacked, and the system administrator account of the database is tampered with.
5.	Firstly, open the website http://localhost/blog/search/, then inpute “0'XOR(if(now()=sysdate(),sleep(10),0))XOR'Z” to the search block. Click search, and the system will 10 seconds before appear the results.

***

##### 解决漏洞：

1.	Replace the special characters in the string, before use it access the database.
2.	SQL injection could be fixed by replace the special characters in the string which user input from the browser or postman. We just change all those character to some safe characters to avoid this problem. Firstly, change the search method in blog.php file. Then use str_replace method to replace dangerous characters of search string(replace “\”, “`”, ”)” by “%” to avoid dangerous query). Then go to the login function in authhelper.php file, use the same method to replace the special characters in string username and password.
3.	The login function in the authhelper.php file and the search function in the blog.php file.
4.	It can avoid dangerous characters to access database, and the user’s input can not affect the system.

***

##### 再次验证漏洞：

1.	I use a lot of SQL injection codes to test the vulnerability. I change different code in login website and search website. And no matter what I do, the vulnerability never appear again.
2.	After I change Use the same repeated request, every time you need to pass the Google verification codethe code, the user cannot search others’ information and the databased will not be affected by the users.
3.	We could regularly check whether the database has been performed special operations by non-administrator users.

***

#### XSS Vulnerability

***

##### 漏洞复现、影响、所在URL：

1.	The user could input script code or html code to affect the system.
2.	http://localhost/admin/blog http://localhost/user/add/ 
3.	add function in the admin/blog.php file, add function in the user.php file.
4.	This vulnerability could make the script code which would written by bad guys execute on the website.
5.	Firstly, use admin account to log in this system. Then click admin website, then start to write a post. And add some script or html code in the article. For example, you could use the code: print "<html>"; print "<h1>Most recent comment</h1>"; print database.latestComment;print "</html>". After this, when people access this article, they will find the comment has been posted on the website, which is strange.

***

##### 解决漏洞：

1.	I add a function to filter the input from the user in the file which need to deal the user input.
2.	Create a function, and the function can deal with input string, it will replace special characters, such as “<”,”>”,”`”, etc. And the function will call the str_replace function, like this. str_replace( array('<','>',"'",'"',')','('), array('&lt;','&gt;','&apos;','&#x22;','&#x29;','&#x28;').
3.	I add this function in the admin/blog.php file. And before I deal the input from the user, I will call this function. For example, I use this function in add function which is in the blog.php file. Besides, I also use this function to filter the users’ input in registraction website.
4.	After I put the filter, the bad guys cannot add some dangerous html code or script code in the system, or just in the website.

***

##### 再次验证漏洞：

1.	I use a lot of different script code to test the system. I put them in the input block, and I submit it to the system. Then I check whether these scripts can execute.
2.	After I fix the problem, the bad guys cannot run their script in this system, and they event cannot use the html flag to messy this system.
3.	I can check the user input regularly to find whether they input some script file, or html code.

***

#### File Inclusion Vulnerability

***

##### 漏洞复现、影响、所在URL：

1.	The user could enter some special characters in the browser to access the files in the system.
2.	http://localhost/page/dispaly 
3.	the function display in the page file.
4.	Open the URL http://localhost/page/display and just type “..%252Finstal.sql”, then people can access the whole sql file in the system. And people also can change different file name after ..%252F to access different files in the system.

***

##### 解决漏洞：

1.	I filter the special characters in the input from the user before it access the method fetch, so it cannot access the root directory in the system. 
2.	Add some methods such as str_repalce to replace the special characters such as “../” and  ”./” from the user’s input. Change the code in the display function which is in the page file. Add str_replace method to replace the “../” and “./” before the urldecode function.
3.	The page file should be changed, the display function should be changed.
4.	After fixing this problem, the bad guys cannot access the files in the system.

***

##### 再次验证漏洞：

1.	I encode some special characters such as “..” to test the system, I input them to the browser, and the system work rightly.
2.	After fixing this problem, people could input some Linux instructions. However these instructions could be filter, so it can protect the system.
3.	Before every fetch function, I could add some filter methods to filter the Linux instructions or some dangerous characters.

***

